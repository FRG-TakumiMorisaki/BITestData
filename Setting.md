# Setting.md

## 1. 企業の概要

- 業種: ソフトウェアを開発・販売する会社（SaaS/ソフトウェアライセンスビジネスを想定）
- データソース: Salesforce をイメージした構造
- 主な部門:
  - 営業部門
  - ソフトウェアサポート部門

### 1.1 営業部門の構成

- 営業部門には **3つのディビジョン（division）** が存在する想定とする。
  - 例: 「営業第1ディビジョン」「営業第2ディビジョン」「エンタープライズ営業」など
- 各ディビジョンの中に **2〜3チーム** が存在する。
- `Department` テーブルの 1 レコードが **1チーム** に対応する。
  - `Department.name`: チーム名（例: "第1ディビジョン_チームA"）
  - `Department.division_name`: ディビジョン名
- 各チームには **5〜7名** の営業担当（User）が所属する。
- 営業担当は主に以下の種類の商談を扱う。
  - 新規（New Business）
  - 更新（Renewal）

#### 1.1.1 営業部門のチーム一覧（固定）

`Department` テーブルに格納される営業チームは下記で固定する。ID も固定し、DDL/インサートと整合させる。

| id | name | division_name | department_type |
| --- | --- | --- | --- |
| 1 | 東日本製造・流通営業1課 | 営業第1ディビジョン（東日本） | Sales |
| 2 | 東日本製造・流通営業2課 | 営業第1ディビジョン（東日本） | Sales |
| 3 | 西日本パートナー営業課 | 営業第1ディビジョン（東日本） | Sales |
| 4 | 公共・金融営業第1課 | 営業第2ディビジョン（公共・金融） | Sales |
| 5 | 公共・金融営業第2課 | 営業第2ディビジョン（公共・金融） | Sales |
| 6 | グローバルアカウント第1課 | エンタープライズ営業本部 | Sales |
| 7 | グローバルアカウント第2課 | エンタープライズ営業本部 | Sales |

### 1.2 ソフトウェアサポート部門の構成

- ソフトウェアのサポートを行う部署があり、**5名×2チーム** で構成される。
- サポート部門のチームも `Department` に登録される。
  - `division_name` を「カスタマーサポート」などで統一し、
  - `name` にチーム名（例: "サポート_チーム1"）を設定する。
- サポート部門のメンバーも `User` テーブルで管理する。

`Department` テーブルに格納されるサポートチームは下記で固定する。

| id | name | division_name | department_type |
| --- | --- | --- | --- |
| 8 | オンボーディング支援チーム | カスタマーサポート | Support |
| 9 | 運用サポートチーム | カスタマーサポート | Support |

### 1.3 会計期と売上目標

- 会計期は **4月はじまり**（例: 2025年度=2025年4月〜2026年3月）。
- 部署ごとの売上目標（単位: 億円）は以下の通り。サポート部門は商談を持たないため、収益目標の対象外とする。

| id | name | 2025年度目標 | 2024年度目標 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | 東日本製造・流通営業1課 | 14.4 | 12.0 | 好調帯の成長率120%を反映。
| 2 | 東日本製造・流通営業2課 | 10.71 | 10.5 | 通常帯の成長率102%を反映。
| 3 | 西日本パートナー営業課 | 9.79 | 9.5 | 通常帯の成長率103%を反映。
| 4 | 公共・金融営業第1課 | 11.44 | 11.0 | 通常帯の成長率104%を反映。
| 5 | 公共・金融営業第2課 | 8.28 | 9.0 | 不調帯の成長率92%を反映。
| 6 | グローバルアカウント第1課 | 14.95 | 13.0 | 好調帯の成長率115%を反映。
| 7 | グローバルアカウント第2課 | 8.80 | 10.0 | 不調帯の成長率88%を反映。

---

## 2. 商談（Opportunity）のビジネスルール

### 2.1 商談の種類と受注率

- 商談には「新規」「更新」の2種類が存在する（`Opportunity.Type` などで表現）。
- 集計レベルで、最終的な受注率は以下を目安にする。
  - 新規商談: **約20%**
  - 更新商談: **約85%**

### 2.2 新規商談のフェーズ（7段階）

新規商談は以下の 7 フェーズで管理される。  
`Stage` と `Probability`（確度, %）の一例は次の通り。

> ※ Stage 名に `New` プレフィックスは付けない。

- `Prospecting`（見込み客発掘）: 10%
- `Qualification`（案件化・要件ヒアリング）: 20%
- `Needs Analysis`（課題・要件定義）: 30%
- `Proposal`（提案・見積提示）: 50%
- `Negotiation`（条件交渉・稟議中）: 70%
- `Verbal Commit`（口頭合意・最終調整）: 90%
- `Closed Won`（受注）: 100%

失注した新規商談は、最終的に `Closed Lost` フェーズに遷移させる。  
`Closed Lost` の確度は **0%** として扱う。

### 2.3 更新商談のフェーズ（3段階）

更新商談は、以下の 3 フェーズでシンプルに管理する。

> ※ Stage 名に `Ren` プレフィックスは付けない。

- `Upcoming Renewal`（更新対象抽出・事前接触）: 50%
- `Renewal Negotiation`（更新条件の交渉・調整）: 75%
- `Closed Won`（更新完了）: 100%

更新商談が失注した場合も、`Closed Lost` フェーズに遷移し、確度は **0%** として扱う。

### 2.4 失注理由（複数選択; 区切り文字は `;`）

商談が失注（Closed Lost）した場合、以下の失注理由から **複数選択** する。  
データ上は `;` 区切りの文字列として保存する（例: `"価格が高い;競合製品を選択"`）。

- 価格が高い
- 競合製品を選択
- 機能要件を満たさない
- 予算が確保できなかった
- タイミングが合わなかった（導入時期 延期・中止）
- 社内事情（組織変更・優先度変更など）
- 顧客側の意思決定プロセスが停滞
- 当社サポート／対応への不安

---

## 3. テーブル一覧と概要

このプロジェクトでは、以下のテーブルを前提としてデータを生成する。  
実際のカラム構成や制約は、SQLite 用の DDL で具体化する。

### 3.1 Department

- **1レコード = 1チーム** を表現する。
- ディビジョン名（大きな括り）とチーム名を持つ。

想定フィールド例:

- `id` (PK)
- `name` — チーム名（例: "第1ディビジョン_チームA"）
- `division_name` — ディビジョン名（例: "営業第1ディビジョン"）
- `department_type` — 例: `Sales`, `Support`

### 3.2 User

- 社員・担当者情報を管理。
- 営業とサポートの両方のメンバーを含む。

想定フィールド例:

- `id` (PK)
- `department_id` (FK -> Department)
- `name`
- `email`
- `role`（例: `SalesRep`, `SalesManager`, `SupportEngineer` など）

### 3.3 Account

- 取引先企業（顧客）情報を管理。

想定フィールド例:

- `id` (PK)
- `name`
- `industry`
- `billing_country`
- `billing_city`
- `created_at`

### 3.4 Contact

- 取引先担当者情報を管理。

想定フィールド例:

- `id` (PK)
- `account_id` (FK -> Account)
- `name`
- `title`
- `email`
- `phone`

### 3.5 Product

- 販売しているソフトウェア製品情報を管理。

想定フィールド例:

- `id` (PK)
- `name`
- `category`（例: `Core`, `Addon`, `Service`）
- `unit_price`
- `is_subscription`（サブスクリプションかどうか）
- `default_term_months`（サブスク期間の標準値）

### 3.6 Opportunity

- 商談のヘッダ情報を管理。

想定フィールド例:

- `id` (PK)
- `account_id` (FK -> Account)
- `owner_user_id` (FK -> User)
- `type`（`New` / `Renewal`）
- `stage`（本設定で定義したステージ名: `Prospecting`, `Renewal Negotiation`, `Closed Won` など）
- `amount`
- `close_date`
- `created_date`
- `probability`（ステージに応じた確度）
- `is_closed`
- `is_won`
- `lost_reasons`（失注時のみ; `;` 区切り文字列）

### 3.7 OpportunityItem

- 商談ごとの製品明細。`Opportunity × Product` の中間テーブル。

想定フィールド例:

- `id` (PK)
- `opportunity_id` (FK -> Opportunity)
- `product_id` (FK -> Product)
- `quantity`
- `unit_price`
- `amount`（`quantity * unit_price`）

### 3.8 OpportunitySnapshot

- 商談の週次スナップショット。スナップショット分析用。

想定フィールド例:

- `id` (PK)
- `opportunity_id` (FK -> Opportunity)
- `stage`
- `amount`
- `close_date`
- `probability`
- `is_closed`
- `is_won`
- `snapshot_date`（スナップショットを取得した週の日付）
- `owner_user_id` (FK -> User)

### 3.9 OpportunityHistory

- 商談に対する重要項目の変更履歴を管理。

対象フィールド（例）:

- `Stage`
- `CloseDate`
- `Amount`

想定フィールド例:

- `id` (PK)
- `opportunity_id` (FK -> Opportunity)
- `field`（変更されたフィールド名: `Stage`, `CloseDate`, `Amount` など）
- `old_value`
- `new_value`
- `changed_at`

---

## 4. データ生成時の留意点

- `Department` レコードはチーム単位で作成し、`division_name` により上位のディビジョンを識別する。
- 営業ディビジョンごとに 2〜3チーム、1チーム5〜7名程度の営業担当を `User` として生成する。
- 新規/更新比率・受注率・フェーズ分布が、BIで分析した際に「現実的に見える」ように調整する。
- サポート部門のユーザーは商談を持たないが、将来的な拡張（サポートケースなど）に備えておく想定とする。
- 商談生成時は、チームごとのパフォーマンスが「好調:通常:不調 = 2:6:2」の比率（商談件数シェアの目安）になるように想定する。以下のチーム別設定を固定し、Sales 7 チームに割り付ける。サポート2チームは商談を持たず、比率計算の対象外。
  - 好調（2枠=商談シェア20%想定）: 東日本製造・流通営業1課（成長率120%）とグローバルアカウント第1課（成長率115%）。
    - 好調の要因: 月次の案件創出数が前年同期比+30〜35%で安定、提案テンプレートとプライシングガイド整備で受注率が3〜5pt改善（新規23%前後/更新88%前後）、クロスセル強化で平均単価が+12〜15%。案件創出増はウェビナー定期開催とパートナー紹介の増加による。
  - 通常（商談シェア60%想定）: 東日本製造・流通営業2課（102%）、西日本パートナー営業課（103%）、公共・金融営業第1課（104%）。
    - 通常の特徴: 案件創出数・受注率・単価は前年とほぼ同程度（新規20%前後/更新85%前後、平均単価±3%以内）。部門平均として扱い、ばらつきは最小限。
  - 不調（2枠=商談シェア20%想定）: 公共・金融営業第2課（92%）、グローバルアカウント第2課（88%）。
    - 不調の要因: 案件創出数が前年同期比▲15〜20%（公共入札の減少や海外案件の遅延）、受注率が3〜6pt低下（新規14〜17%/更新78〜80%）し、価格競争や為替影響で平均単価も▲8〜12%。フィールドマーケ施策の遅れと競合参入が背景。
